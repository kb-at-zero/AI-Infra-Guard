info:
  name: llamafactory
  cve: CVE-2025-61784
  summary: LLaMA Factory's Chat API contains critical SSRF and LFI vulnerabilities
  details: |
    A Server-Side Request Forgery (SSRF) vulnerability exists in the `_process_request` function within `src/llamafactory/api/chat.py`, allowing authenticated users to force the server to make arbitrary HTTP requests to internal or external endpoints. The same flaw enables Local File Inclusion (LFI), permitting attackers to read arbitrary files from the server.
    The issue arises because URLs provided for multimodal content (images, videos, audio) are not validated before being fetched using `requests.get(url, stream=True).raw`. These functions are invoked via the `/v1/chat/completions` API endpoint, making them publicly exploitable by any authenticated user.
    An attacker can exploit this by submitting a crafted message with a URL pointing to internal services (e.g., AWS metadata endpoints) or local file paths like `/etc/passwd`.
    **Vulnerable Code Example**:
    ```python
    image_stream = requests.get(image_url, stream=True).raw
    ```
    **Impact**:
    - Exposure of internal services and cloud metadata.
    - Unauthorized access to sensitive files on the host.
    - Potential credential leakage and lateral movement.
  cvss: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:L
  severity: CRITICAL
  security_advise: |
    1. Upgrade to a patched version of LLaMA Factory where URL validation is enforced.
    2. Implement strict allowlists for outbound HTTP requests made by the application.
    3. Sanitize all user-provided URLs and reject local file paths or private IP ranges.
    4. Audit logs for suspicious activity involving chat API usage.
rule: version >= "0" && version <= "0.9.3"
references:
  - https://github.com/hiyouga/LLaMA-Factory/security/advisories/GHSA-527m-2xhr-j27g
  - https://nvd.nist.gov/vuln/detail/CVE-2025-61784
  - https://github.com/hiyouga/LLaMA-Factory/commit/95b7188090a1018935c9dc072bfc97f24f1c96e9
  - https://github.com/hiyouga/LLaMA-Factory