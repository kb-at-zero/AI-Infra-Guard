info:
  name: llamafactory
  cve: CVE-2025-61784
  summary: LLaMA Factory 的聊天 API 存在严重的 SSRF 和 LFI 漏洞
  details: |
    在 `src/llamafactory/api/chat.py` 文件中的 `_process_request` 函数中存在一个服务器端请求伪造（SSRF）漏洞，允许经过身份验证的用户强制服务器向内部或外部端点发起任意 HTTP 请求。同一缺陷还导致本地文件包含（LFI），使攻击者能够读取服务器上的任意文件。
    此问题产生的原因是未对多模态内容（图像、视频、音频）提供的 URL 进行验证就直接使用 `requests.get(url, stream=True).raw` 发起请求。这些函数通过 `/v1/chat/completions` API 端点被调用，因此任何已认证的用户都可公开利用该漏洞。
    攻击者可以通过提交一条精心构造的消息来利用此漏洞，其中包含指向内部服务（例如 AWS 元数据端点）或本地文件路径（如 `/etc/passwd`）的 URL。
    **易受攻击的代码示例**：
    ```python
    image_stream = requests.get(image_url, stream=True).raw
    ```
    **影响**：
    - 暴露内部服务和云元数据。
    - 对主机上敏感文件的未授权访问。
    - 可能导致凭证泄露及横向移动。
  cvss: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:L
  severity: CRITICAL
  security_advise: |
    1. 升级到已修复 SSRF 漏洞并实施 URL 验证机制的 LLaMA Factory 版本。
    2. 实施严格的应用程序出站 HTTP 请求白名单策略。
    3. 清理所有用户输入的 URL，并拒绝本地文件路径或私有 IP 范围。
    4. 审计与聊天 API 使用相关的可疑活动日志。
rule: version >= "0" && version <= "0.9.3"
references:
  - https://github.com/hiyouga/LLaMA-Factory/security/advisories/GHSA-527m-2xhr-j27g
  - https://nvd.nist.gov/vuln/detail/CVE-2025-61784
  - https://github.com/hiyouga/LLaMA-Factory/commit/95b7188090a1018935c9dc072bfc97f24f1c96e9
  - https://github.com/hiyouga/LLaMA-Factory